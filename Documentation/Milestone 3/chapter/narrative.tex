\chapter{Narrative and Reflective Account}
\label{ch:narrative}

    The following chapter will include a narrative account of the processes we went through to develop this project, from planning introductory meetings with the client, to how we conducted the acceptance testing to ensure that our devices are functional. Following this, we will evaluate the final progress of the project against the requirements we specified in our Milestone 1 document \cite{coaker}, before moving onto discussing the problems we faced during project development and how we attempted to overcome those problems. Finally, we will conclude our narrative account by providing concluding remarks detailing how the project went.

    Following the narrative account, we will include a reflective remarks section which will detail what we learnt during this process, how we would improve it if we did it again, and what more we would have done had we been allowed more time.

    \section{Narrative Account}
    \label{sec:narrative_account}

        The following section is a narrative account section, where we will detail the process we went through to complete this project. After that, we will evaluate the success of the progress by concluding how complete each previously agreed requirement is. We will then detail the main issues we faced during the project's lifecycle and how we went about solving those issues. Finally, we will conclude how the project went overall.

        \subsection{Introductory Meetings}

            Our first step was to contact the client to arrange an initial meeting together to allow us to gain an idea of how the client would like the project to be implemented. However, we found that we left the meeting with more questions than we went in with. We found ourselves in a situation where the project could go down multiple directions. Having had discussions with our supervisor regarding this, he recommended that we guide the project in the direction that suited our team the best. Therefore, we arranged another meeting with the client and encouraged them to agree to allow the product to be developed such that we created two devices that monitored the patient's and walking aid's movements with the use of accelerometers. The client agreed to this project idea, and we began its development.

        \subsection{Milestone 1}

            Following our initial meetings with the client, we focussed our attentions on the upcoming December 14th deadline for our Milestone 1 document. The Milestone 1 document was designed to allow our group to lay out a specification document for our project which included the requirements for the project, a specification, our chosen methodology for developing the project and how we planned to split the work load. We also included a risk analysis section which was critical in allowing us to detect issues that were likely to arise during the project's lifecycle. 

            During the development of the Milestone 1 document, we created a mock table of functional and non-functional requirements to be sent to the client for approval. Once we received approval for the requirements, we finalised them and included them in the final Milestone 1 document. We ultimately decided that the requirements would be used throughout the development of the project as a means to evaluate our progress and to finally decide in this document whether the project was a success or not.

        \subsection{Ordering Hardware}

            Upon the submission of our Milestone 1 document, we began the process of compiling a list of hardware devices that we felt necessary to procure to allow for the successful development of our product. We initially ran into some issues where our list of hardware was far greater than the budget that had been assigned to us by the client. Because of this, we asked the University if we could borrow two TinyPICOs to ultimately lower the overall cost of our hardware to being within budget. We faced issues here however, with our contact in the University taking a while to respond and with the client being on annual leave over the Christmas period. Therefore, once we received confirmation that we could borrow two TinyPICOs from the University, we were left in a position where we could not order our hardware until the beginning of February. Following this, we experienced some delays with the company delivering the hardware that meant that valuable development time was lost. More specifically, we received delivery of our hardware items on the 3rd of March, 15 days before we needed to submit our Milestone 2 document, a report on the progress that had been made on the project so far. Further information on the issues we faced with procuring hardware and how we managed to limit their downsides can be read in section \ref{subsec:hardware_procurement}.

        \subsection{Software Development Prior to Milestone 2}

            Having experienced delays in the delivery of the hardware and with the deadline to a progress report fast approaching, we realised that we needed to identify a way of making meaningful progress on the software development side of the project. As one of our team members already had access to two TinyPICO devices, we were able to quickly develop communication code that would provide the foundations for communication between our walking aid and wearable devices. Once this was developed, we were forced into waiting until we received our hardware order before we could progress further with code development. 

            Upon receiving our hardware on the 3rd of March, we instantly began development of code that would allow for walking detection within the wearable device. We soldered TinyPICOs and ADXL345 accelerometers to allow for the testing of our walking detection system and developed two different solutions for counting steps through the accelerometer. Those solutions included a step counter that measured changes in gravity to detect steps, and a step counter that measured changes in acceleration to detect steps. The work following the development of these two solutions included the testing of these two solutions to identify which was most appropriate for use within our project. This allowed us to create comparisons of the two solutions which could be included in our Milestone 2 progress report.

        \subsection{Milestone 2}

            Due for submission on March 18th was a progress report, namely Milestone 2. This document was designed for us to be able to submit a report on the work that had been carried out on the project, an update on our risk analysis section depending on the risks and issues that we had already faced, and an update on the schedule that we had previously set out in our Milestone 1 document. The development of the document was quite difficult as only one team member had developed any code at this point. Because of this, it meant that only that particular team member could discuss the progress that had been made and detail design decisions such as why we opted to use ESP-Now for communication between our devices, rather than another technology such as Bluetooth and Ultra-wideband. Because of this, other team members needed to be assigned to the development of the schedule and risk-analysis update sections. 

            As well as including the progress made in terms of software development within this report, one team member began developing 3D designs of the housing for our devices that we encase our hardware items in for the prototypes. Once designs had been created, that team member began the process of 3D printing the housing for the walking aid device so that we could discuss the progress made in this area within the Milestone 2 document. 
            
            As well as this, we provided budgeting and hardware ordering details within our report as well as a discussion on the issues we had already faced and how they had impacted the project so far. The updated risk analysis section reflected the issues we had already faced with risks arising, where we included changes to mitigation strategies, an update on the likelihood of the risks happening and the level of impact they would have, further risks that had not been identified in the Milestone 1 document. Following this, we provided an update to our schedule that reflected the criticism we received for our previous schedule in Milestone 1. Further details on this update can be viewed in section \ref{subsec:schedule}.

        \subsection{Completing Software and Hardware Development}

            Following the submission of our Milestone 2 progress report document, we turned our attentions for the final time to the development of the software and hardware systems of the devices. We had already implemented the communications and movement detection systems and decided to utilise the changes in gravity monitoring system for step counting in the wearable device. The next system to implement was the audio file loading and playing system. During the process of developing the code to play the reminder audio file, we decided that it would be best to have the MP3 audio file loaded onto the TinyPICO's volatile memory to allow for the quick reading of the audio file when a reminder needed to be played. We faced frustrating delays due to the initial use of an inefficient library, but once we identified a fix for the inefficiencies, we were able to complete the development of a system that transfers an MP3 audio file from a MicroSD card onto the SPIFFS volatile memory of the TinyPICO. Further details of this issue we faced and how we solved it can be seen in section \ref{subsubsec:sd}.

            Upon developing the system that transfers an MP3 file from the MicroSD card to SPIFFS memory and having the audio played when a communication was received from the wearable device, we developed the movement detection system of the walking aid device. This was a simple implementation as it uses the same system as the movement detection system that we opted to use in the wearable device. We then developed the system that checks whether movement was detected within the last 10 seconds, and if not gives the user 10 seconds to move the walking aid before playing the audio reminder. That completed the full implementation of the audio reminder system. In full, the wearable device detects whether 5 steps are taken within a 10 second period. If so, a message is sent to the walking aid device to check if the walking aid is moving. A check is made to see movement has been detected in the last 10 seconds, if not a further 10 seconds is given to the user to allow them to move the walking aid. Should the case be that the walking aid has not been moved, then the audio reminder is played.

            Building on top of this, we developed a further system that sends a message back to the wearable device if the device is set to vibrate rather than having the walking aid device play an audio reminder. We implemented a two-way communication system with ESP-Now to complete this and now means that should the wearable device detect a message from the walking aid device, it vibrates for 1 second. This feature was implemented as an alternative option to the audio reminder system for users who are hearing-impaired. The completion of this feature marked the conclusion to software development for this project. Following the conclusion of software development, we began the process of acceptance testing to provide evidence of testing to be included within this document. Further information of our acceptance testing can be viewed in chapter \ref{ch:testing}.

            Alongside the development of the software for this project, one team member took on the role of developing the housing for both our walking aid and wearable devices, due to their previous experience working in this area. They managed to initially develop CAD designs for both devices with priority being placed on maintaining a small form factor. Upon completing the CAD designs, the housing itself was printed using a 3D printer and were fitted with the necessary hardware for each device. The walking aid device housing features an adjustable mount to allow the device to fit varying sizes of walking aids, with the wearable device featuring a clip-on mount to allow the wearable to be fitted to patients' clothing or ankle and wrist straps. Further information on the design decisions for the housing of each device can be viewed in sections \ref{subsec:Design_Decisions_walking_aid} and \ref{subsec:Design_Decisions_wearable}.

        \subsection{Evaluating the Project}
        \label{subsec:evaluation}

            This section will evaluate whether the project was a success or not by listing our requirements from our Milestone 1 document \cite{coaker}, and comparing them to the final progress of the project. We will detail whether those requirements have been met and why, before concluding the section with a body of text that evaluates our overall satisfaction with the outcome of the project. The listed requirements will also include some requirements that were omitted from the Milestone 1 document \cite{coaker} and were identified later into the project's lifecycle. The list of requirements, progress made to fulfil those requirements, and the details behind how that progress was made is listed below.

            \input{chapter/evaluation_tables.tex}
            \vspace{2em}

            Due to the evaluation of the progress towards requirements above, we feel that we have completed this project and all the requirements that were necessary to be completed by the project deadline. We are aware that a stretch goal was not managed to be completed prior to the project deadline, however this is a stretch goal and was not necessary to be completed by the project deadline. Because of this, we feel that the project is complete.

        \subsection{Problems and Solutions}
        \label{subsec:probs_solutions}

            This section will discuss the problems that we faced during the development of this project, with respect to the schedule specified in Milestone's 1 and 2 \cite{coaker, mile2}, our identified risks and problems we faced due to our assigned team roles and the methodology we decided to adhere to for the development of this project. 

            \subsubsection{Schedule}
            \label{subsec:schedule}

                In our Milestone 1 document \cite{coaker}, we laid out a time plan and schedule that we would aim to follow to ensure that the project was completed on time. We were given feedback on this schedule that stated that our assigned time to each sprint was far too long and needed to be shortened to allow for easier planning of feature development and document writing. This turned out to be the case and caused many issues with the initial progress of the project. The biggest issue caused by this was the fact that our team was not proactive enough in the writing of the Milestone 1 document, the ordering of hardware and the development of designs for the overall system. Those designs could have been created far earlier in the project's lifecycle and included within this document. A Gantt chart of our schedule specified in Milestone 1 can be viewed in figure \ref{fig:ganttm1} and demonstrates the original planned sprints that ultimately caused us issues.

                \input{graphics/ganttm1.tex}
                
                We attempted to solve these issues by trying to order our hardware after the Christmas period and by attempting to complete our Milestone 1 document within a week of the deadline. Had we made our sprints shorter, we could have created a more proactive mindset within the team to complete these pieces of work sooner and ultimately save time to develop the project further in future. To ensure that we did not face these issues for the remaining time of the project, we decided to make our sprints shorter for the Gantt chart schedule that we included in our Milestone 2 document \cite{mile2}. This Gantt chart demonstrates the conscious effort we made to shorten our sprints and attempt to create a more proactive mindset within the team by encouraging the team to advance the project sufficiently for each sprint deadline. Figure \ref{fig:ganttm2} demonstrates this Gantt chart.

                \input{graphics/ganttm2.tex}

                Upon adjusting our second Gantt chart, we noticed that our team was more actively attempting to progress the project with each passing sprint. Having said this, it would be interesting to monitor the activity of the team had both schedules been compared at similar stages of the project's lifecycle. We say this as it is a fair assumption that the project might also have progressed more consistently in the latter stages of its lifecycle due to the fact that the team were more pressured as the project deadline approached.

            \subsubsection{Hardware Procurement}
            \label{subsec:hardware_procurement}

                As mentioned in our previous Milestone 2 document \cite{mile2}, we experienced delays in the procurement of hardware devices necessary to develop the project. These delays resulted in the delays of beginning code development, which ultimately left us in a position of having limited time to complete the project and not enough time to test all the potential technologies that we could have used. Hardware delivery delays occurred due to the complex process required to be completed to order hardware through the University, as well as courier delays taking place. Having said this, we could have limited the likelihood of this issue occurring by having the team prioritise the hardware procurement process earlier in the lifecycle of the project. Ultimately, we should have foreseen potential delays over the Christmas and New Year period, and ensured that we had our hardware orders sorted before the University closed for Christmas. 

                Without the benefits of hindsight, we attempted to complete the work we could complete without the full hardware inventory which allowed us to save time later on in the project lifecycle to develop the other features. As we already had an inventory of 2 TinyPICO boards, we were able to implement the communication protocol whilst waiting for the delivery of the full hardware inventory. This meant that when the full inventory was delivered, we could focus our attentions to the development of the other features, such as movement detection and the audio system in the walking aid device. This solution worked well and certainly eased the pressure when developing the other features of our systems. However, had we managed to order our hardware earlier, we could have started to implement the stretch goals supplied to us that would have advanced the project to the next level.

            \subsubsection{Lack of a Team Leader}

                Before beginning the process of developing this project, we were encouraged to avoid selecting a team lead, which was understandable as this is a student project where all group members are expected to contribute an equal amount. However, we found that not having a team leader might have been detrimental to the overall work ethic of the team. One member attempted to take a team leader role implicitly by attempting to lead by example with the amount of work they were committing to the git repository. Unfortunately, this seemed to have still led to a negative outcome where some team members were potentially avoiding completing work with the confidence that the leading team member would continue to complete the work instead. Because of this, the progress of the project was certainly negatively affected with some features and documents needing to be rushed. Having said this, the solution that the implicit team leader attempted certainly advanced the progress of the project and ultimately still managed to push the project to a point where the team feel that it is complete and meets the requirements specified in the Milestone 1 document \cite{coaker}.

            \subsubsection{Non-Functional I\textsuperscript{2}C Communication in ADXL345 Library}

                When developing the initial code for retrieving readings from the ADXL accelerometer, we were instantly limited to using I\textsuperscript{2}C communication rather than SPI communication as the SPI communication technology was being occupied by the audio shield within the walking aid device. However, we noticed that the library we were using was failing to communicate with the accelerometer effectively over I\textsuperscript{2}C. Due to the developer's previous experience in working with I\textsuperscript{2}C, we were able to identify an unnecessary line of the code in the library that was limiting the communication to the accelerometer from working. The original function that we needed to edit can be seen in figure \ref{lst:old_accel}.

                \lstinputlisting[language=C++, caption=The original erroneous function within the accelerometer library., label=lst:old_accel]{listings/old_accel_lib.cpp}

                The line of code that was causing the error was the extra unnecessary beginTransmission call that was included in line 8. The solution was to simply remove this line of code and the I\textsuperscript{2}C communication system between the TinyPICO and the accelerometer was instantly functional. Having already implemented this fix, we later identified that a newer version of this library existed on GitHub which fixes this very issue. However, this version was not available on the Arduino libraries manager, so that is why we opted to edit the library ourselves. There are huge benefits to this though, as it gave us first-hand experience of attempting to understand and edit code that was written by other developers. Our solution to this issue can be seen in figure \ref{lst:new_accel}.

                \lstinputlisting[language=C++, caption=Our fixed function edited within the accelerometer library., label=lst:new_accel]{listings/new_accel_lib.cpp}

            \subsubsection{Inefficient SD Library}
            \label{subsubsec:sd}

                This issue was outlined previously in section \ref{subsec:sdfat}, but we thought we should reiterate it here in a narrative format. When developing the code that allowed the transferral of an audio file from the MicroSD card to the SPIFFS storage space on the TinyPICO development boards we opted to utilise the SD library provided by Arduino. This was due to the fact that the library was designed as a wrapper for the more complex SdFat library. In essence, we opted to use the Arduino SD library as it looked to be simple to implement and use for our purposes. However, we noticed that the SD library was taking a remarkably long time to read the audio file on the MicroSD card. More specifically, the library was taking 150 seconds to read a 150 KB MP3 file, which was completely unacceptable for our purposes. Upon further investigation, we noticed that many other developers were experiencing a similar issue and were recommending the use of the original SdFat library instead. It took some time to implement this library but once we did, the improvements were astounding. We were able to instantly decrease the read time of the audio file from 150 seconds, down to about 10 seconds. This solution provided a huge improvement in our ability to read the audio file from the MicroSD card and was crucial in the development of our product. This issue did provide a learning opportunity for us, allowing our team to realise that research should be done into libraries before utilising them, and to not always select the library that seems the easiest to implement at the time.

        \subsection{Concluding Remarks}

            To conclude, we feel that the project was a success overall. We managed to implement the requirements that were agreed upon at the beginning of the project's lifecycle. We certainly feel that issues that we faced along the way limited the overall outcome of the project and effectively restricted our team from being able to implement stretch goals on time, and test the system with different technologies to identify the optimal makeup of the system. Many of those issues were self-inflicted, where we feel that many of the issues could have been avoided had we made an effort as a team to be more proactive. For example, the ordering of devices as soon as possible could have avoided the delays that we experienced, and using time management to develop parts of our documentation whilst waiting for code to be developed could have left more time for code development closer to the project deadline. Having said this, the project is certainly as successful as we hoped it would be, and we feel confident that the product that we have developed can provide the basis of technology that can improve the quality of life of dementia patients and their carers in future. We believe that what we have developed here provides an insight into how such devices can be developed with a short time frame, and minimal budget, and hope that it can be advantageous to the developers that take this project on board when we hand it over to the client.

    \section{Requirements and Topic}
    \label{sec:reqs}

    The first thing we did was to arrange a meeting with the client, who in this case was a representative of Bangor Health Clinic. The reason for this meeting is to understand better the topic and also gather the requirements from the client. At first, we thought of two possible outcomes, according to the client's requirements, developing a wearable device or a non-wearable device. The first one is a device similar to a watch that will include an accelerometer, which will be responsible for calculating the user's movement, and the second one is a pressure pad, that will detect when the user is sitting or not to it. We proposed to Bangor Health Clinic, the first solution rather than the second, as the second might need extra information to calculate the user's movement, for instance, if the user stands up there is no way of understanding if the user is walking, or creating a solution in which the pad can be easily cleaned up. All of these reasons were also very difficult for us to implement, so we chose the first solution as it is the more passable solution when it comes to our skills.

    \section{Development}
    \label{sec:development}

    The next step is the development of the proposed solution, including the methodology we followed. The development of the Walking Aid System was tough for our team, to complete in time, as we lost valuable time at the beginning of the project while waiting for the proper equipment to arrive. Fortunately, we moved the project forward in both software and hardware development, developing prototypes, after their arrival. The loss of that time was something from which our timetable could never recover. Although we realized that working on a project that includes both software and hardware development may necessitate additional time, the delivery and arrival of the equipment may take extra time; therefore, the project plan must be adaptable to those dates. The development is split into three sections, the first section contains all the problems we encountered for the software development, the second section contains all the problems we encountered for the hardware development, and the final one contains all the problems we encountered for the risk analysis. Each section will highlight how we solved the problem if it was solved, and what we learnt from that solution.

    \subsection{Software Development}
    \label{ssec:software}

    Working on this type of project that requires software and hardware development was very challenging for us, especially when it comes to hardware selection, which was the first problem we faced. Because the initial budget we required exceeded the one allocated by the customer, we devised a method to reduce the ordering budget by borrowing two TinyPICOs from the University. Having now all the equimpent we needed to find a solution on how these two systems will communicate with each other. Choosing a communication protocol was a key challenge since we required one that would not exceed our budget while still being extremely precise at a long-range. As a result, we chose the ESP-Now protocol for communication between our TinyPICOs since it is simple to integrate with ESP32 chips and has a range of 220 meters.

    % Add more information about walking detection system, problems and solutions.

    \subsection{Hardware Development}
    \label{ssec:hardware}

    % What problems we encountered during this phase, and what are our solutions.
    % What we learnt from the problem(s) and the solution(s)

    \subsection{Risk Analysis}
    \label{ssec:}

    % What problems we encountered while defining risks
    When we defined our risks in Milestone 1 \cite{coaker}, we ran into issues with our budget and hardware procurement, which caused us to lose development time as mentioned in the previous section \ref{sec:development}. However, in Milestone 2 \cite{mile2}, we revised our risks because the loss of development time was still affecting our schedule, so we needed to conduct team meetings so we could oversee the project's progress, whether we were still behind schedule or not.

    \section{Reflection}
    \label{sec:Reflection}

    From this group project, the first thing we learnt from developing a project for a client is that working in groups is very difficult, especially when not all members contribute at the same level. This is something that happened in this project, as some members did not pull their weight, resulting in many incomplete tasks being left to be completed at the last minute. This might have happened since everyone's schedules were different, but it doesn't imply it's not a reasonable reason for everyone's workload. Of course, if all of the team members were equally devoted to this project, we would have greater outcomes and not have as much work to do near the finish.

    Needless to say, given this was a group project, we had to hold meetings to maintain track of the project's development. Using Discord for our meetings eased and simplified things for us. In addition, we used GitHub, which improved our git expertise and made it easy for us to divide the documentation work and all of the project's work in general.

    Although, this project gave us the chance to implement software engineering principles we learnt through the years of our studies, such as software design, choosing a proper methodology, developing a project plan and also working as a team.
